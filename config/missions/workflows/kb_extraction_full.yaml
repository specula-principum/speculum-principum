id: kb_extraction_full
goal: |
  Deliver the end-to-end knowledge base extraction for an issue that already passed triage
  and carries the "kb-extraction" and "ready-for-copilot" labels:
  1. Fetch the issue and confirm both labels remain present. If either label is missing,
     post a guidance comment and stop.
  2. Execute the extraction pipeline using the declared source information without
     re-running intake validation.
  3. Validate the generated knowledge base artifacts.
  4. Produce a quality report summarizing the extraction status and validation metrics,
     then post it on the issue.
  5. Apply a completion label ("kb-extracted" on success, "kb-extraction-failed" on
     failure) while leaving the triage labels unchanged.

constraints:
  - Assume template validation was completed during triage; only verify readiness labels
    before proceeding.
  - Do not modify the issue title or body.
  - Do not remove existing labels except when adding the completion status.
  - Do not alter the original source documents.
  - Keep comments focused on extraction results and next steps.

success_criteria:
  - The required triage labels were confirmed (or missing-label guidance was posted) before
    extraction continued.
  - Extraction ran against the declared source.
  - Knowledge base validation executed on the resulting artifacts.
  - A quality report comment was published with relevant metrics.
  - Exactly one completion label was applied without disturbing other labels.

max_steps: 25

allowed_tools:
  - get_issue_details
  - extract_kb_knowledge
  - validate_kb
  - generate_kb_report
  - post_comment
  - add_label

requires_approval: false
