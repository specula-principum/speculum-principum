id: pr_auto_merge_kb
goal: |
  Review a pull request and determine if it's safe to auto-merge:
  1. Fetch PR details and file changes
  2. Analyze changed files to ensure:
     - All changes are within knowledge-base/ directory
     - No files were deleted (except frontmatter updates)
     - Changes are additive (new content or edits)
     - No source code or configuration files modified
  3. If changes are in knowledge-base/ only:
     - Run KB validation on the modified files
     - If validation passes, approve the PR with comment
     - If validation fails, request changes with specific errors
  4. If changes include files outside knowledge-base/:
     - Post comment explaining why auto-merge is not safe
     - Do NOT approve or merge
     - Explain which files require human review
  5. Only merge if:
     - All checks pass
     - Changes are KB-only and valid
     - Human approval was granted (requires_approval: true)

constraints:
  - Never merge PRs with source code changes
  - Never merge PRs with configuration file changes
  - Never merge PRs with test file changes
  - Always validate KB content before approval
  - Provide specific reasons if auto-merge is rejected
  - Only merge after explicit human approval

success_criteria:
  - PR files were analyzed correctly
  - KB validation was run if needed
  - Appropriate review comment was posted
  - PR was approved only if safe and valid
  - PR was merged only after human approval
  - Agent explained its decision clearly

max_steps: 20

allowed_tools:
  - get_pr_details
  - get_pr_files
  - validate_kb
  - post_comment
  - approve_pr
  - merge_pr

requires_approval: true  # Merging requires human approval
