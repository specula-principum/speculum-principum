# Mission to monitor registered sources for content changes.

id: monitor_sources
version: 1
metadata:
  owner: copilot-orchestrator
  created_at: 2025-12-26
  summary_tooling: source-monitoring

goal: |
  Monitor registered sources and queue them for acquisition when needed.
  
  This mission handles TWO distinct modes:
  
  MODE 1 - Initial Acquisition (last_content_hash is None):
  - Source was recently approved but never acquired
  - Skip change detection (nothing to compare)
  - Create `initial-acquisition` Issue for full source fetch
  - Acquisition Agent will set last_content_hash after completion
  
  MODE 2 - Update Monitoring (last_content_hash exists):
  - Source has been previously acquired
  - Perform tiered change detection:
    * Tier 1: Compare HTTP ETag header
    * Tier 2: Compare Last-Modified header  
    * Tier 3: Compare content hash (only if tiers 1-2 indicate change)
  - Create `content-update` Issue only if content actually changed
  
  Workflow steps:
  1. Get list of sources pending initial acquisition
  2. For each pending source, create initial-acquisition Issue
  3. Get list of sources due for update check
  4. For each due source, check for changes
  5. If changed, create content-update Issue
  6. Update source monitoring metadata (last_checked, next_check_after)
  7. Report persistent access failures (5+ consecutive failures)
  
  This mission runs on schedule via GitHub Actions (every 6 hours).

constraints:
  - "For initial acquisition: create single Issue per source, not per page"
  - "For updates: use HEAD requests first to minimize bandwidth"
  - "Respect rate limits: minimum 1 second between requests to same domain"
  - "Do not fetch full content unless change is detected (update mode only)"
  - "Do not create duplicate Issues - check markers before creation"
  - "Update source metadata even when no change detected (last_checked)"
  - "Maximum 5 consecutive failures before marking source degraded"
  - "Primary sources get high priority, reference sources get low priority"

success_criteria:
  - Sources needing initial acquisition have `initial-acquisition` Issues
  - Changed sources have `content-update` Issues created
  - No duplicate Issues created for same content version
  - Source monitoring metadata updated in registry
  - Access problems reported for sources with 5+ failures

max_steps: 50
allowed_tools:
  # Read tools
  - list_sources
  - get_source
  - get_sources_pending_initial
  - get_sources_due_for_check
  - check_source_for_changes
  - verify_source_accessibility
  
  # Write tools
  - update_source_monitoring_metadata
  - create_initial_acquisition_issue
  - create_content_update_issue
  - report_source_access_problem
  - update_source_status

requires_approval: false
